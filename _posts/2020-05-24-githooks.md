---
# layout: post
title: Become git hooked!
date: 2020-05-24 16:01 +0800
categories:
  - Productivity
  - Git
tags:
  - git
  - githooks
  - automation
---

Using git hooks can boost your productivity. Do more with less and improve your git skillset with this simple hook.

Somewhat recently I joined a larger team of developers. As part of our development flow, anyone can prepare the production release. Than implies that whoever is preparing it, also drafts the release notes. Our release notes are relatively simple and as part of standardizing the format, I recently started dividing them into 3 main categories:
'Features', 'Fixes' and 'Internal Changes'.
Within each of the groups we are supposed to reference the ticket id/title and link the PR that was opened with the changes made.
If we have not been involved in all the features that are about to be released it is sometimes hard to link the information back. most of the messages are not entirely clear, nor reference a ticket. Usually most of the needed information is on the PR description, but once that it has been merged, the initial PR description is "lost". In order to solve this, I proposed we relied on the combo: standard branch names + githooks. Through this methodology we can rely on a githook to prepare the commit message for us with a reference to the ticket we are working on.
E.g. for the branch name:
```
STAR-333-implement-amazing-code
```
whenever we run `git commit -m "some message"` the hook will prefix it with the reference to the ticket, as such:
```
[STAR-333] some message
```

What this hook is doing is parsing our branch name and look for a regex that would match our ticket number. Based on that, if it finds a match, it prefixes our commit message with the ticket number unless the commit message already has one.

This assumes one has the githook installed in the dev machine from which we are committing. Since workflow changes are usually a challenge and if people are not motivated to do the change they won't I also wanted to look for a solution that didn't' require much of developers time. This would be straightforward if the `.git` folder was committed to the remote repository, but it isn't so I had to come up with another solution. In order to achieve that, I've prepared my hook file and stored it under .githooks directory, which I committed to the remote. Alongside with this, I've written a simple makefile that loops through the .githooks directory and creates symlinks under .git for each of the files in .githooks.
With these two simple steps, as part of the instructions on how to setup the development environment, the developers are asked to run `make`, which will create the previously mentioned symlinks.

As I wrote before, the githook pre commit prepare message needs to have a conventional branch name creation because we are using a regex to find the ticket reference. In order to do this in a comfortable way, I use a tool that I've [written about before]({% post_url 2019-10-29-story-branch%}) (and I'm also the maintainer of) called [StoryBranch](https://github.com/story-branch/story_branch). Both the blog post or the readme of the gem should give you enough context on why I've built the tool and how I'm using it.

To summarize:

- We find important and valuable having a reference to the ticket on the commit messages
- This can be a tedious task if done manually but it can be easily automated assuming we follow some conventions.
- A git hook combined with a standard branch name solves the issue.

Both the git hook `prepare-commit-message` and the `Makefile` are available in [gist](https://gist.github.com/rpbaltazar/969206aa33617325d985b1daf1c0d8eb)
